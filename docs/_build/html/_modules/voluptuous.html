<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>voluptuous &mdash; Voluptuous 0.8.11 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.8.11',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Voluptuous 0.8.11 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for voluptuous</h1><div class="highlight"><pre>
<span class="c"># encoding: utf-8</span>
<span class="c">#</span>
<span class="c"># Copyright (C) 2010-2013 Alec Thomas &lt;alec@swapoff.org&gt;</span>
<span class="c"># All rights reserved.</span>
<span class="c">#</span>
<span class="c"># This software is licensed as described in the file COPYING, which</span>
<span class="c"># you should have received as part of this distribution.</span>
<span class="c">#</span>
<span class="c"># Author: Alec Thomas &lt;alec@swapoff.org&gt;</span>

<span class="sd">&quot;&quot;&quot;Schema validation for Python data structures.</span>

<span class="sd">Given eg. a nested data structure like this:</span>

<span class="sd">    {</span>
<span class="sd">        &#39;exclude&#39;: [&#39;Users&#39;, &#39;Uptime&#39;],</span>
<span class="sd">        &#39;include&#39;: [],</span>
<span class="sd">        &#39;set&#39;: {</span>
<span class="sd">            &#39;snmp_community&#39;: &#39;public&#39;,</span>
<span class="sd">            &#39;snmp_timeout&#39;: 15,</span>
<span class="sd">            &#39;snmp_version&#39;: &#39;2c&#39;,</span>
<span class="sd">        },</span>
<span class="sd">        &#39;targets&#39;: {</span>
<span class="sd">            &#39;localhost&#39;: {</span>
<span class="sd">                &#39;exclude&#39;: [&#39;Uptime&#39;],</span>
<span class="sd">                &#39;features&#39;: {</span>
<span class="sd">                    &#39;Uptime&#39;: {</span>
<span class="sd">                        &#39;retries&#39;: 3,</span>
<span class="sd">                    },</span>
<span class="sd">                    &#39;Users&#39;: {</span>
<span class="sd">                        &#39;snmp_community&#39;: &#39;monkey&#39;,</span>
<span class="sd">                        &#39;snmp_port&#39;: 15,</span>
<span class="sd">                    },</span>
<span class="sd">                },</span>
<span class="sd">                &#39;include&#39;: [&#39;Users&#39;],</span>
<span class="sd">                &#39;set&#39;: {</span>
<span class="sd">                    &#39;snmp_community&#39;: &#39;monkeys&#39;,</span>
<span class="sd">                },</span>
<span class="sd">            },</span>
<span class="sd">        },</span>
<span class="sd">    }</span>

<span class="sd">A schema like this:</span>

<span class="sd">    &gt;&gt;&gt; settings = {</span>
<span class="sd">    ...   &#39;snmp_community&#39;: str,</span>
<span class="sd">    ...   &#39;retries&#39;: int,</span>
<span class="sd">    ...   &#39;snmp_version&#39;: All(Coerce(str), Any(&#39;3&#39;, &#39;2c&#39;, &#39;1&#39;)),</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; features = [&#39;Ping&#39;, &#39;Uptime&#39;, &#39;Http&#39;]</span>
<span class="sd">    &gt;&gt;&gt; schema = Schema({</span>
<span class="sd">    ...    &#39;exclude&#39;: features,</span>
<span class="sd">    ...    &#39;include&#39;: features,</span>
<span class="sd">    ...    &#39;set&#39;: settings,</span>
<span class="sd">    ...    &#39;targets&#39;: {</span>
<span class="sd">    ...      &#39;exclude&#39;: features,</span>
<span class="sd">    ...      &#39;include&#39;: features,</span>
<span class="sd">    ...      &#39;features&#39;: {</span>
<span class="sd">    ...        str: settings,</span>
<span class="sd">    ...      },</span>
<span class="sd">    ...    },</span>
<span class="sd">    ... })</span>

<span class="sd">Validate like so:</span>

<span class="sd">    &gt;&gt;&gt; schema({</span>
<span class="sd">    ...   &#39;set&#39;: {</span>
<span class="sd">    ...     &#39;snmp_community&#39;: &#39;public&#39;,</span>
<span class="sd">    ...     &#39;snmp_version&#39;: &#39;2c&#39;,</span>
<span class="sd">    ...   },</span>
<span class="sd">    ...   &#39;targets&#39;: {</span>
<span class="sd">    ...     &#39;exclude&#39;: [&#39;Ping&#39;],</span>
<span class="sd">    ...     &#39;features&#39;: {</span>
<span class="sd">    ...       &#39;Uptime&#39;: {&#39;retries&#39;: 3},</span>
<span class="sd">    ...       &#39;Users&#39;: {&#39;snmp_community&#39;: &#39;monkey&#39;},</span>
<span class="sd">    ...     },</span>
<span class="sd">    ...   },</span>
<span class="sd">    ... }) == {</span>
<span class="sd">    ...   &#39;set&#39;: {&#39;snmp_version&#39;: &#39;2c&#39;, &#39;snmp_community&#39;: &#39;public&#39;},</span>
<span class="sd">    ...   &#39;targets&#39;: {</span>
<span class="sd">    ...     &#39;exclude&#39;: [&#39;Ping&#39;],</span>
<span class="sd">    ...     &#39;features&#39;: {&#39;Uptime&#39;: {&#39;retries&#39;: 3},</span>
<span class="sd">    ...                  &#39;Users&#39;: {&#39;snmp_community&#39;: &#39;monkey&#39;}}}}</span>
<span class="sd">    True</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>


<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
    <span class="kn">import</span> <span class="nn">urllib.parse</span> <span class="kn">as</span> <span class="nn">urlparse</span>
    <span class="nb">long</span> <span class="o">=</span> <span class="nb">int</span>
    <span class="nb">unicode</span> <span class="o">=</span> <span class="nb">str</span>
    <span class="nb">basestring</span> <span class="o">=</span> <span class="nb">str</span>
    <span class="n">ifilter</span> <span class="o">=</span> <span class="nb">filter</span>
    <span class="n">iteritems</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">ifilter</span>
    <span class="kn">import</span> <span class="nn">urlparse</span>
    <span class="n">iteritems</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span>


<span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;Alec Thomas &lt;alec@swapoff.org&gt;&#39;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s">&#39;0.8.9&#39;</span>


<span class="nd">@contextmanager</span>
<div class="viewcode-block" id="raises"><a class="viewcode-back" href="../voluptuous.html#voluptuous.raises">[docs]</a><span class="k">def</span> <span class="nf">raises</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">except</span> <span class="n">exc</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">msg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">==</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%r</span><span class="s"> != </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">regex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="s">&#39;</span><span class="si">%r</span><span class="s"> does not match </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">regex</span><span class="p">)</span></div>


<div class="viewcode-block" id="Undefined"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Undefined">[docs]</a><span class="k">class</span> <span class="nc">Undefined</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;...&#39;</span></div>


<span class="n">UNDEFINED</span> <span class="o">=</span> <span class="n">Undefined</span><span class="p">()</span>


<div class="viewcode-block" id="default_factory"><a class="viewcode-back" href="../voluptuous.html#voluptuous.default_factory">[docs]</a><span class="k">def</span> <span class="nf">default_factory</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">UNDEFINED</span> <span class="ow">or</span> <span class="nb">callable</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="k">return</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">value</span></div>


<span class="c"># options for extra keys</span>
<span class="n">PREVENT_EXTRA</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c"># any extra key not in schema will raise an error</span>
<span class="n">ALLOW_EXTRA</span> <span class="o">=</span> <span class="mi">1</span>    <span class="c"># extra keys not in schema will be included in output</span>
<span class="n">REMOVE_EXTRA</span> <span class="o">=</span> <span class="mi">2</span>   <span class="c"># extra keys not in schema will be excluded from output</span>


<div class="viewcode-block" id="Error"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Error">[docs]</a><span class="k">class</span> <span class="nc">Error</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base validation exception.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="SchemaError"><a class="viewcode-back" href="../voluptuous.html#voluptuous.SchemaError">[docs]</a><span class="k">class</span> <span class="nc">SchemaError</span><span class="p">(</span><span class="n">Error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An error was encountered in the schema.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Invalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Invalid">[docs]</a><span class="k">class</span> <span class="nc">Invalid</span><span class="p">(</span><span class="n">Error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The data was invalid.</span>

<span class="sd">    :attr msg: The error message.</span>
<span class="sd">    :attr path: The path to the error, as a list of keys in the source data.</span>
<span class="sd">    :attr error_message: The actual error message that was raised, as a</span>
<span class="sd">        string.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">error_message</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">error_type</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">Error</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_message</span> <span class="o">=</span> <span class="n">error_message</span> <span class="ow">or</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_type</span> <span class="o">=</span> <span class="n">error_type</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s">&#39; @ data[</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="s">&#39;][&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">))</span> \
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="ne">Exception</span><span class="o">.</span><span class="n">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_type</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="s">&#39; for &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_type</span>
        <span class="k">return</span> <span class="n">output</span> <span class="o">+</span> <span class="n">path</span></div>


<div class="viewcode-block" id="MultipleInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.MultipleInvalid">[docs]</a><span class="k">class</span> <span class="nc">MultipleInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[:]</span> <span class="k">if</span> <span class="n">errors</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;MultipleInvalid(</span><span class="si">%r</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">msg</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">error_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">error_message</span>

<div class="viewcode-block" id="MultipleInvalid.add"><a class="viewcode-back" href="../voluptuous.html#voluptuous.MultipleInvalid.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="RequiredFieldInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.RequiredFieldInvalid">[docs]</a><span class="k">class</span> <span class="nc">RequiredFieldInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Required field was missing.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="ObjectInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.ObjectInvalid">[docs]</a><span class="k">class</span> <span class="nc">ObjectInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The value we found was not an object.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="DictInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.DictInvalid">[docs]</a><span class="k">class</span> <span class="nc">DictInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The value found was not a dict.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="ExclusiveInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.ExclusiveInvalid">[docs]</a><span class="k">class</span> <span class="nc">ExclusiveInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;More than one value found in exclusion group.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="InclusiveInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.InclusiveInvalid">[docs]</a><span class="k">class</span> <span class="nc">InclusiveInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Not all values found in inclusion group.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="SequenceItemInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.SequenceItemInvalid">[docs]</a><span class="k">class</span> <span class="nc">SequenceItemInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;One of the values found in a sequence was invalid.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="SequenceTypeInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.SequenceTypeInvalid">[docs]</a><span class="k">class</span> <span class="nc">SequenceTypeInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The type found is not a sequence type.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="TypeInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.TypeInvalid">[docs]</a><span class="k">class</span> <span class="nc">TypeInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The value was not of required type.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="ValueInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.ValueInvalid">[docs]</a><span class="k">class</span> <span class="nc">ValueInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The value was found invalid by evaluation function.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="ScalarInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.ScalarInvalid">[docs]</a><span class="k">class</span> <span class="nc">ScalarInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Scalars did not match.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="CoerceInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.CoerceInvalid">[docs]</a><span class="k">class</span> <span class="nc">CoerceInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Impossible to coerce value to type.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="AnyInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.AnyInvalid">[docs]</a><span class="k">class</span> <span class="nc">AnyInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The value did not pass any validator.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="AllInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.AllInvalid">[docs]</a><span class="k">class</span> <span class="nc">AllInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The value did not pass all validators.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="MatchInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.MatchInvalid">[docs]</a><span class="k">class</span> <span class="nc">MatchInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The value does not match the given regular expression.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="RangeInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.RangeInvalid">[docs]</a><span class="k">class</span> <span class="nc">RangeInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The value is not in given range.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="TrueInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.TrueInvalid">[docs]</a><span class="k">class</span> <span class="nc">TrueInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The value is not True.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="FalseInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.FalseInvalid">[docs]</a><span class="k">class</span> <span class="nc">FalseInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The value is not False.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="BooleanInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.BooleanInvalid">[docs]</a><span class="k">class</span> <span class="nc">BooleanInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The value is not a boolean.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="UrlInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.UrlInvalid">[docs]</a><span class="k">class</span> <span class="nc">UrlInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The value is not a url.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="FileInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.FileInvalid">[docs]</a><span class="k">class</span> <span class="nc">FileInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The value is not a file.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="DirInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.DirInvalid">[docs]</a><span class="k">class</span> <span class="nc">DirInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The value is not a directory.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="PathInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.PathInvalid">[docs]</a><span class="k">class</span> <span class="nc">PathInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The value is not a path.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="LiteralInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.LiteralInvalid">[docs]</a><span class="k">class</span> <span class="nc">LiteralInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The literal values do not match.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="VirtualPathComponent"><a class="viewcode-back" href="../voluptuous.html#voluptuous.VirtualPathComponent">[docs]</a><span class="k">class</span> <span class="nc">VirtualPathComponent</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="bp">self</span> <span class="o">+</span> <span class="s">&#39;&gt;&#39;</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__str__</span><span class="p">()</span></div>


<div class="viewcode-block" id="Schema"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Schema">[docs]</a><span class="k">class</span> <span class="nc">Schema</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A validation schema.</span>

<span class="sd">    The schema is a Python tree-like structure where nodes are pattern</span>
<span class="sd">    matched against corresponding trees of values.</span>

<span class="sd">    Nodes can be values, in which case a direct comparison is used, types,</span>
<span class="sd">    in which case an isinstance() check is performed, or callables, which will</span>
<span class="sd">    validate and optionally convert the value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_extra_to_name</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">REMOVE_EXTRA</span><span class="p">:</span> <span class="s">&#39;REMOVE_EXTRA&#39;</span><span class="p">,</span>
        <span class="n">ALLOW_EXTRA</span><span class="p">:</span> <span class="s">&#39;ALLOW_EXTRA&#39;</span><span class="p">,</span>
        <span class="n">PREVENT_EXTRA</span><span class="p">:</span> <span class="s">&#39;PREVENT_EXTRA&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="n">PREVENT_EXTRA</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new Schema.</span>

<span class="sd">        :param schema: Validation schema. See :module:`voluptuous` for details.</span>
<span class="sd">        :param required: Keys defined in the schema must be in the data.</span>
<span class="sd">        :param extra: Specify how extra keys in the data are treated:</span>
<span class="sd">            - :const:`~voluptuous.PREVENT_EXTRA`: to disallow any undefined</span>
<span class="sd">              extra keys (raise ``Invalid``).</span>
<span class="sd">            - :const:`~voluptuous.ALLOW_EXTRA`: to include undefined extra</span>
<span class="sd">              keys in the output.</span>
<span class="sd">            - :const:`~voluptuous.REMOVE_EXTRA`: to exclude undefined extra keys</span>
<span class="sd">              from the output.</span>
<span class="sd">            - Any value other than the above defaults to</span>
<span class="sd">              :const:`~voluptuous.PREVENT_EXTRA`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">schema</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="n">required</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extra</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">extra</span><span class="p">)</span>  <span class="c"># ensure the value is an integer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compiled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&lt;Schema(</span><span class="si">%s</span><span class="s">, extra=</span><span class="si">%s</span><span class="s">, required=</span><span class="si">%s</span><span class="s">) object at 0x</span><span class="si">%x</span><span class="s">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_to_name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extra</span><span class="p">,</span> <span class="s">&#39;??&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate data against this schema.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compiled</span><span class="p">([],</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">MultipleInvalid</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="n">Invalid</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MultipleInvalid</span><span class="p">([</span><span class="n">e</span><span class="p">])</span>
        <span class="c"># return self.validate([], self.schema, data)</span>

    <span class="k">def</span> <span class="nf">_compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="n">Extra</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">Object</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_object</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_dict</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_list</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_tuple</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
        <span class="n">type_</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">type_</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">:</span>
            <span class="n">type_</span> <span class="o">=</span> <span class="n">schema</span>
        <span class="k">if</span> <span class="n">type_</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span>
                     <span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">None</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">callable</span><span class="p">(</span><span class="n">schema</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_compile_scalar</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">SchemaError</span><span class="p">(</span><span class="s">&#39;unsupported schema data type </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span>
                          <span class="nb">type</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_compile_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">invalid_msg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create validator for given mapping.&quot;&quot;&quot;</span>
        <span class="n">invalid_msg</span> <span class="o">=</span> <span class="n">invalid_msg</span> <span class="ow">or</span> <span class="s">&#39;mapping value&#39;</span>

        <span class="c"># Keys that may be required</span>
        <span class="n">all_required_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">schema</span>
                                <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Extra</span>
                                <span class="ow">and</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">required</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">Optional</span><span class="p">,</span> <span class="n">Remove</span><span class="p">)))</span>
                                     <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">Required</span><span class="p">)))</span>

        <span class="c"># Keys that may have defaults</span>
        <span class="n">all_default_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">schema</span>
                               <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">Required</span><span class="p">)</span>
                               <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">Optional</span><span class="p">))</span>

        <span class="n">_compiled_schema</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">skey</span><span class="p">,</span> <span class="n">svalue</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">schema</span><span class="p">):</span>
            <span class="n">new_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile</span><span class="p">(</span><span class="n">skey</span><span class="p">)</span>
            <span class="n">new_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile</span><span class="p">(</span><span class="n">svalue</span><span class="p">)</span>
            <span class="n">_compiled_schema</span><span class="p">[</span><span class="n">skey</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_key</span><span class="p">,</span> <span class="n">new_value</span><span class="p">)</span>

        <span class="n">candidates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_iterate_mapping_candidates</span><span class="p">(</span><span class="n">_compiled_schema</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">validate_mapping</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">iterable</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
            <span class="n">required_keys</span> <span class="o">=</span> <span class="n">all_required_keys</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="c"># keeps track of all default keys that haven&#39;t been filled</span>
            <span class="n">default_keys</span> <span class="o">=</span> <span class="n">all_default_keys</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">error</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
                <span class="n">key_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">remove_key</span> <span class="o">=</span> <span class="bp">False</span>

                <span class="c"># compare each given key/value against all compiled key/values</span>
                <span class="c"># schema key, (compiled key, compiled value)</span>
                <span class="k">for</span> <span class="n">skey</span><span class="p">,</span> <span class="p">(</span><span class="n">ckey</span><span class="p">,</span> <span class="n">cvalue</span><span class="p">)</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">new_key</span> <span class="o">=</span> <span class="n">ckey</span><span class="p">(</span><span class="n">key_path</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                    <span class="k">except</span> <span class="n">Invalid</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">key_path</span><span class="p">):</span>
                            <span class="k">raise</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">error</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
                            <span class="n">error</span> <span class="o">=</span> <span class="n">e</span>
                        <span class="k">continue</span>
                    <span class="c"># Backtracking is not performed once a key is selected, so if</span>
                    <span class="c"># the value is invalid we immediately throw an exception.</span>
                    <span class="n">exception_errors</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="c"># check if the key is marked for removal</span>
                    <span class="n">is_remove</span> <span class="o">=</span> <span class="n">new_key</span> <span class="ow">is</span> <span class="n">Remove</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">cval</span> <span class="o">=</span> <span class="n">cvalue</span><span class="p">(</span><span class="n">key_path</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                        <span class="c"># include if it&#39;s not marked for removal</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_remove</span><span class="p">:</span>
                            <span class="n">out</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">cval</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">remove_key</span> <span class="o">=</span> <span class="bp">True</span>
                            <span class="k">continue</span>
                    <span class="k">except</span> <span class="n">MultipleInvalid</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">exception_errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
                    <span class="k">except</span> <span class="n">Invalid</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">exception_errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">exception_errors</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">is_remove</span> <span class="ow">or</span> <span class="n">remove_key</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">exception_errors</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">key_path</span><span class="p">):</span>
                                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">err</span><span class="o">.</span><span class="n">error_type</span> <span class="o">=</span> <span class="n">invalid_msg</span>
                                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                        <span class="c"># If there is a validation error for a required</span>
                        <span class="c"># key, this means that the key was provided.</span>
                        <span class="c"># Discard the required key so it does not</span>
                        <span class="c"># create an additional, noisy exception.</span>
                        <span class="n">required_keys</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">skey</span><span class="p">)</span>
                        <span class="k">break</span>

                    <span class="c"># Key and value okay, mark any Required() fields as found.</span>
                    <span class="n">required_keys</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">skey</span><span class="p">)</span>

                    <span class="c"># No need for a default if it was filled</span>
                    <span class="n">default_keys</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">skey</span><span class="p">)</span>

                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">remove_key</span><span class="p">:</span>
                        <span class="c"># remove key</span>
                        <span class="k">continue</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">extra</span> <span class="o">==</span> <span class="n">ALLOW_EXTRA</span><span class="p">:</span>
                        <span class="n">out</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">extra</span> <span class="o">!=</span> <span class="n">REMOVE_EXTRA</span><span class="p">:</span>
                        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Invalid</span><span class="p">(</span><span class="s">&#39;extra keys not allowed&#39;</span><span class="p">,</span> <span class="n">key_path</span><span class="p">))</span>
                    <span class="c"># else REMOVE_EXTRA: ignore the key so it&#39;s removed from output</span>

            <span class="c"># set defaults for any that can have defaults</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">default_keys</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="n">Undefined</span><span class="p">):</span>  <span class="c"># if the user provides a default with the node</span>
                    <span class="n">out</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">schema</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">default</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required_keys</span><span class="p">:</span>
                        <span class="n">required_keys</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="c"># for any required keys left that weren&#39;t found and don&#39;t have defaults:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required_keys</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">msg</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&#39;msg&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span><span class="o">.</span><span class="n">msg</span> <span class="k">else</span> <span class="s">&#39;required key not provided&#39;</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RequiredFieldInvalid</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">path</span> <span class="o">+</span> <span class="p">[</span><span class="n">key</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MultipleInvalid</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">out</span>

        <span class="k">return</span> <span class="n">validate_mapping</span>

    <span class="k">def</span> <span class="nf">_compile_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate an object.</span>

<span class="sd">        Has the same behavior as dictionary validator but work with object</span>
<span class="sd">        attributes.</span>

<span class="sd">        For example:</span>

<span class="sd">            &gt;&gt;&gt; class Structure(object):</span>
<span class="sd">            ...     def __init__(self, one=None, three=None):</span>
<span class="sd">            ...         self.one = one</span>
<span class="sd">            ...         self.three = three</span>
<span class="sd">            ...</span>
<span class="sd">            &gt;&gt;&gt; validate = Schema(Object({&#39;one&#39;: &#39;two&#39;, &#39;three&#39;: &#39;four&#39;}, cls=Structure))</span>
<span class="sd">            &gt;&gt;&gt; with raises(MultipleInvalid, &quot;not a valid value for object value @ data[&#39;one&#39;]&quot;):</span>
<span class="sd">            ...   validate(Structure(one=&#39;three&#39;))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base_validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_mapping</span><span class="p">(</span>
            <span class="n">schema</span><span class="p">,</span> <span class="n">invalid_msg</span><span class="o">=</span><span class="s">&#39;object value&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">validate_object</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">schema</span><span class="o">.</span><span class="n">cls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNDEFINED</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">schema</span><span class="o">.</span><span class="n">cls</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="n">ObjectInvalid</span><span class="p">(</span><span class="s">&#39;expected a {0!r}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">schema</span><span class="o">.</span><span class="n">cls</span><span class="p">),</span> <span class="n">path</span><span class="p">)</span>
            <span class="n">iterable</span> <span class="o">=</span> <span class="n">_iterate_object</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">iterable</span> <span class="o">=</span> <span class="n">ifilter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="n">iterable</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">base_validate</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">iterable</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)(</span><span class="o">**</span><span class="n">out</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">validate_object</span>

    <span class="k">def</span> <span class="nf">_compile_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate a dictionary.</span>

<span class="sd">        A dictionary schema can contain a set of values, or at most one</span>
<span class="sd">        validator function/type.</span>

<span class="sd">        A dictionary schema will only validate a dictionary:</span>

<span class="sd">            &gt;&gt;&gt; validate = Schema({})</span>
<span class="sd">            &gt;&gt;&gt; with raises(MultipleInvalid, &#39;expected a dictionary&#39;):</span>
<span class="sd">            ...   validate([])</span>

<span class="sd">        An invalid dictionary value:</span>

<span class="sd">            &gt;&gt;&gt; validate = Schema({&#39;one&#39;: &#39;two&#39;, &#39;three&#39;: &#39;four&#39;})</span>
<span class="sd">            &gt;&gt;&gt; with raises(MultipleInvalid, &quot;not a valid value for dictionary value @ data[&#39;one&#39;]&quot;):</span>
<span class="sd">            ...   validate({&#39;one&#39;: &#39;three&#39;})</span>

<span class="sd">        An invalid key:</span>

<span class="sd">            &gt;&gt;&gt; with raises(MultipleInvalid, &quot;extra keys not allowed @ data[&#39;two&#39;]&quot;):</span>
<span class="sd">            ...   validate({&#39;two&#39;: &#39;three&#39;})</span>


<span class="sd">        Validation function, in this case the &quot;int&quot; type:</span>

<span class="sd">            &gt;&gt;&gt; validate = Schema({&#39;one&#39;: &#39;two&#39;, &#39;three&#39;: &#39;four&#39;, int: str})</span>

<span class="sd">        Valid integer input:</span>

<span class="sd">            &gt;&gt;&gt; validate({10: &#39;twenty&#39;})</span>
<span class="sd">            {10: &#39;twenty&#39;}</span>

<span class="sd">        By default, a &quot;type&quot; in the schema (in this case &quot;int&quot;) will be used</span>
<span class="sd">        purely to validate that the corresponding value is of that type. It</span>
<span class="sd">        will not Coerce the value:</span>

<span class="sd">            &gt;&gt;&gt; with raises(MultipleInvalid, &quot;extra keys not allowed @ data[&#39;10&#39;]&quot;):</span>
<span class="sd">            ...   validate({&#39;10&#39;: &#39;twenty&#39;})</span>

<span class="sd">        Wrap them in the Coerce() function to achieve this:</span>

<span class="sd">            &gt;&gt;&gt; validate = Schema({&#39;one&#39;: &#39;two&#39;, &#39;three&#39;: &#39;four&#39;,</span>
<span class="sd">            ...                    Coerce(int): str})</span>
<span class="sd">            &gt;&gt;&gt; validate({&#39;10&#39;: &#39;twenty&#39;})</span>
<span class="sd">            {10: &#39;twenty&#39;}</span>

<span class="sd">        Custom message for required key</span>

<span class="sd">            &gt;&gt;&gt; validate = Schema({Required(&#39;one&#39;, &#39;required&#39;): &#39;two&#39;})</span>
<span class="sd">            &gt;&gt;&gt; with raises(MultipleInvalid, &quot;required @ data[&#39;one&#39;]&quot;):</span>
<span class="sd">            ...   validate({})</span>

<span class="sd">        (This is to avoid unexpected surprises.)</span>

<span class="sd">        Multiple errors for nested field in a dict:</span>

<span class="sd">        &gt;&gt;&gt; validate = Schema({</span>
<span class="sd">        ...     &#39;adict&#39;: {</span>
<span class="sd">        ...         &#39;strfield&#39;: str,</span>
<span class="sd">        ...         &#39;intfield&#39;: int</span>
<span class="sd">        ...     }</span>
<span class="sd">        ... })</span>
<span class="sd">        &gt;&gt;&gt; try:</span>
<span class="sd">        ...     validate({</span>
<span class="sd">        ...         &#39;adict&#39;: {</span>
<span class="sd">        ...             &#39;strfield&#39;: 123,</span>
<span class="sd">        ...             &#39;intfield&#39;: &#39;one&#39;</span>
<span class="sd">        ...         }</span>
<span class="sd">        ...     })</span>
<span class="sd">        ... except MultipleInvalid as e:</span>
<span class="sd">        ...     print(sorted(str(i) for i in e.errors)) # doctest: +NORMALIZE_WHITESPACE</span>
<span class="sd">        [&quot;expected int for dictionary value @ data[&#39;adict&#39;][&#39;intfield&#39;]&quot;,</span>
<span class="sd">         &quot;expected str for dictionary value @ data[&#39;adict&#39;][&#39;strfield&#39;]&quot;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base_validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_mapping</span><span class="p">(</span>
            <span class="n">schema</span><span class="p">,</span> <span class="n">invalid_msg</span><span class="o">=</span><span class="s">&#39;dictionary value&#39;</span><span class="p">)</span>

        <span class="n">groups_of_exclusion</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">groups_of_inclusion</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">schema</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Exclusive</span><span class="p">):</span>
                <span class="n">g</span> <span class="o">=</span> <span class="n">groups_of_exclusion</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">group_of_exclusion</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">g</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Inclusive</span><span class="p">):</span>
                <span class="n">g</span> <span class="o">=</span> <span class="n">groups_of_inclusion</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">group_of_inclusion</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">g</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">validate_dict</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">DictInvalid</span><span class="p">(</span><span class="s">&#39;expected a dictionary&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

            <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups_of_exclusion</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">exists</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">for</span> <span class="n">exclusive</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">exclusive</span><span class="o">.</span><span class="n">schema</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">exists</span><span class="p">:</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="n">exclusive</span><span class="o">.</span><span class="n">msg</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">exclusive</span><span class="p">,</span> <span class="s">&#39;msg&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">exclusive</span><span class="o">.</span><span class="n">msg</span> <span class="k">else</span> \
                                <span class="s">&quot;two or more values in the same group of exclusion &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">label</span>
                            <span class="n">next_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="p">[</span><span class="n">VirtualPathComponent</span><span class="p">(</span><span class="n">label</span><span class="p">)]</span>
                            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ExclusiveInvalid</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">next_path</span><span class="p">))</span>
                            <span class="k">break</span>
                        <span class="n">exists</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MultipleInvalid</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups_of_inclusion</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">included</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">schema</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">group</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">included</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">included</span><span class="p">):</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="bp">None</span>
                    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s">&#39;msg&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">g</span><span class="o">.</span><span class="n">msg</span><span class="p">:</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">msg</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="n">msg</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;some but not all values in the same group of &quot;</span>
                               <span class="s">&quot;inclusion &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">label</span>
                    <span class="n">next_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="p">[</span><span class="n">VirtualPathComponent</span><span class="p">(</span><span class="n">label</span><span class="p">)]</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">InclusiveInvalid</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">next_path</span><span class="p">))</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MultipleInvalid</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>

            <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">return</span> <span class="n">base_validate</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">out</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">validate_dict</span>

    <span class="k">def</span> <span class="nf">_compile_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">seq_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate a sequence type.</span>

<span class="sd">        This is a sequence of valid values or validators tried in order.</span>

<span class="sd">        &gt;&gt;&gt; validator = Schema([&#39;one&#39;, &#39;two&#39;, int])</span>
<span class="sd">        &gt;&gt;&gt; validator([&#39;one&#39;])</span>
<span class="sd">        [&#39;one&#39;]</span>
<span class="sd">        &gt;&gt;&gt; with raises(MultipleInvalid, &#39;invalid list value @ data[0]&#39;):</span>
<span class="sd">        ...   validator([3.5])</span>
<span class="sd">        &gt;&gt;&gt; validator([1])</span>
<span class="sd">        [1]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_compiled</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_compile</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">schema</span><span class="p">]</span>
        <span class="n">seq_type_name</span> <span class="o">=</span> <span class="n">seq_type</span><span class="o">.</span><span class="n">__name__</span>

        <span class="k">def</span> <span class="nf">validate_sequence</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">seq_type</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">SequenceTypeInvalid</span><span class="p">(</span><span class="s">&#39;expected a </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">seq_type_name</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

            <span class="c"># Empty seq schema, allow any data.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">schema</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">data</span>

            <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">invalid</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">index_path</span> <span class="o">=</span> <span class="n">UNDEFINED</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="n">index_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">invalid</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">for</span> <span class="n">validate</span> <span class="ow">in</span> <span class="n">_compiled</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">cval</span> <span class="o">=</span> <span class="n">validate</span><span class="p">(</span><span class="n">index_path</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">cval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Remove</span><span class="p">:</span>  <span class="c"># do not include Remove values</span>
                            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cval</span><span class="p">)</span>
                        <span class="k">break</span>
                    <span class="k">except</span> <span class="n">Invalid</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">index_path</span><span class="p">):</span>
                            <span class="k">raise</span>
                        <span class="n">invalid</span> <span class="o">=</span> <span class="n">e</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">invalid</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">index_path</span><span class="p">):</span>
                        <span class="n">invalid</span> <span class="o">=</span> <span class="n">SequenceItemInvalid</span><span class="p">(</span><span class="s">&#39;invalid </span><span class="si">%s</span><span class="s"> value&#39;</span> <span class="o">%</span> <span class="n">seq_type_name</span><span class="p">,</span> <span class="n">index_path</span><span class="p">)</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">invalid</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MultipleInvalid</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)(</span><span class="n">out</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">validate_sequence</span>

    <span class="k">def</span> <span class="nf">_compile_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate a tuple.</span>

<span class="sd">        A tuple is a sequence of valid values or validators tried in order.</span>

<span class="sd">        &gt;&gt;&gt; validator = Schema((&#39;one&#39;, &#39;two&#39;, int))</span>
<span class="sd">        &gt;&gt;&gt; validator((&#39;one&#39;,))</span>
<span class="sd">        (&#39;one&#39;,)</span>
<span class="sd">        &gt;&gt;&gt; with raises(MultipleInvalid, &#39;invalid tuple value @ data[0]&#39;):</span>
<span class="sd">        ...   validator((3.5,))</span>
<span class="sd">        &gt;&gt;&gt; validator((1,))</span>
<span class="sd">        (1,)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_sequence</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_compile_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate a list.</span>

<span class="sd">        A list is a sequence of valid values or validators tried in order.</span>

<span class="sd">        &gt;&gt;&gt; validator = Schema([&#39;one&#39;, &#39;two&#39;, int])</span>
<span class="sd">        &gt;&gt;&gt; validator([&#39;one&#39;])</span>
<span class="sd">        [&#39;one&#39;]</span>
<span class="sd">        &gt;&gt;&gt; with raises(MultipleInvalid, &#39;invalid list value @ data[0]&#39;):</span>
<span class="sd">        ...   validator([3.5])</span>
<span class="sd">        &gt;&gt;&gt; validator([1])</span>
<span class="sd">        [1]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_sequence</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>

<div class="viewcode-block" id="Schema.extend"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Schema.extend">[docs]</a>    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new `Schema` by merging this and the provided `schema`.</span>

<span class="sd">        Neither this `Schema` nor the provided `schema` are modified. The</span>
<span class="sd">        resulting `Schema` inherits the `required` and `extra` parameters of</span>
<span class="sd">        this, unless overridden.</span>

<span class="sd">        Both schemas must be dictionary-based.</span>

<span class="sd">        :param schema: dictionary to extend this `Schema` with</span>
<span class="sd">        :param required: if set, overrides `required` of this `Schema`</span>
<span class="sd">        :param extra: if set, overrides `extra` of this `Schema`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">,</span> <span class="s">&#39;Both schemas must be dictionary-based&#39;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>

        <span class="n">result_required</span> <span class="o">=</span> <span class="p">(</span><span class="n">required</span> <span class="k">if</span> <span class="n">required</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="p">)</span>
        <span class="n">result_extra</span> <span class="o">=</span> <span class="p">(</span><span class="n">extra</span> <span class="k">if</span> <span class="n">extra</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">extra</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Schema</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="n">result_required</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="n">result_extra</span><span class="p">)</span></div></div>


<span class="k">def</span> <span class="nf">_compile_scalar</span><span class="p">(</span><span class="n">schema</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A scalar value.</span>

<span class="sd">    The schema can either be a value or a type.</span>

<span class="sd">    &gt;&gt;&gt; _compile_scalar(int)([], 1)</span>
<span class="sd">    1</span>
<span class="sd">    &gt;&gt;&gt; with raises(Invalid, &#39;expected float&#39;):</span>
<span class="sd">    ...   _compile_scalar(float)([], &#39;1&#39;)</span>

<span class="sd">    Callables have</span>
<span class="sd">    &gt;&gt;&gt; _compile_scalar(lambda v: float(v))([], &#39;1&#39;)</span>
<span class="sd">    1.0</span>

<span class="sd">    As a convenience, ValueError&#39;s are trapped:</span>

<span class="sd">    &gt;&gt;&gt; with raises(Invalid, &#39;not a valid value&#39;):</span>
<span class="sd">    ...   _compile_scalar(lambda v: float(v))([], &#39;a&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">validate_instance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;expected </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">schema</span><span class="o">.</span><span class="n">__name__</span>
                <span class="k">raise</span> <span class="n">TypeInvalid</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">validate_instance</span>

    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">schema</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">validate_callable</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">schema</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValueInvalid</span><span class="p">(</span><span class="s">&#39;not a valid value&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">MultipleInvalid</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">errors</span><span class="p">:</span>
                    <span class="n">error</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="n">error</span><span class="o">.</span><span class="n">path</span>
                <span class="k">raise</span>
            <span class="k">except</span> <span class="n">Invalid</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">e</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">path</span>
                <span class="k">raise</span>
        <span class="k">return</span> <span class="n">validate_callable</span>

    <span class="k">def</span> <span class="nf">validate_value</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="n">schema</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ScalarInvalid</span><span class="p">(</span><span class="s">&#39;not a valid value&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">return</span> <span class="n">validate_value</span>


<span class="k">def</span> <span class="nf">_compile_itemsort</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;return sort function of mappings&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">is_extra</span><span class="p">(</span><span class="n">key_</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key_</span> <span class="ow">is</span> <span class="n">Extra</span>

    <span class="k">def</span> <span class="nf">is_remove</span><span class="p">(</span><span class="n">key_</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key_</span><span class="p">,</span> <span class="n">Remove</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_marker</span><span class="p">(</span><span class="n">key_</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key_</span><span class="p">,</span> <span class="n">Marker</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_type</span><span class="p">(</span><span class="n">key_</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">key_</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_callable</span><span class="p">(</span><span class="n">key_</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">callable</span><span class="p">(</span><span class="n">key_</span><span class="p">)</span>

    <span class="c"># priority list for map sorting (in order of checking)</span>
    <span class="c"># We want Extra to match last, because it&#39;s a catch-all. On the other hand,</span>
    <span class="c"># Remove markers should match first (since invalid values will not</span>
    <span class="c"># raise an Error, instead the validator will check if other schemas match</span>
    <span class="c"># the same value).</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="n">is_remove</span><span class="p">),</span>    <span class="c"># Remove highest priority after values</span>
                <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">is_marker</span><span class="p">),</span>    <span class="c"># then other Markers</span>
                <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">is_type</span><span class="p">),</span>      <span class="c"># types/classes lowest before Extra</span>
                <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">is_callable</span><span class="p">),</span>  <span class="c"># callables after markers</span>
                <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">is_extra</span><span class="p">)]</span>     <span class="c"># Extra lowest priority</span>

    <span class="k">def</span> <span class="nf">item_priority</span><span class="p">(</span><span class="n">item_</span><span class="p">):</span>
        <span class="n">key_</span> <span class="o">=</span> <span class="n">item_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">check_</span> <span class="ow">in</span> <span class="n">priority</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">check_</span><span class="p">(</span><span class="n">key_</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">i</span>
        <span class="c"># values have hightest priorities</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">item_priority</span>

<span class="n">_sort_item</span> <span class="o">=</span> <span class="n">_compile_itemsort</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_iterate_mapping_candidates</span><span class="p">(</span><span class="n">schema</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Iterate over schema in a meaningful order.&quot;&quot;&quot;</span>
    <span class="c"># Without this, Extra might appear first in the iterator, and fail to</span>
    <span class="c"># validate a key even though it&#39;s a Required that has its own validation,</span>
    <span class="c"># generating a false positive.</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">iteritems</span><span class="p">(</span><span class="n">schema</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">_sort_item</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_iterate_object</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return iterator over object attributes. Respect objects with</span>
<span class="sd">    defined __slots__.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="c"># maybe we have named tuple here?</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;_asdict&#39;</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">item</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">__slots__</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">slots</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s">&#39;__dict__&#39;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
    <span class="k">raise</span> <span class="ne">StopIteration</span><span class="p">()</span>


<div class="viewcode-block" id="Object"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Object">[docs]</a><span class="k">class</span> <span class="nc">Object</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Indicate that we should work with attributes, not keys.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">cls</span><span class="o">=</span><span class="n">UNDEFINED</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cls</span> <span class="o">=</span> <span class="n">cls</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Object</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span></div>


<div class="viewcode-block" id="Marker"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Marker">[docs]</a><span class="k">class</span> <span class="nc">Marker</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mark nodes for special treatment.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">schema</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Invalid</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">schema</span></div>


<div class="viewcode-block" id="Optional"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Optional">[docs]</a><span class="k">class</span> <span class="nc">Optional</span><span class="p">(</span><span class="n">Marker</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mark a node in the schema as optional, and optionally provide a default</span>

<span class="sd">    &gt;&gt;&gt; schema = Schema({Optional(&#39;key&#39;): str})</span>
<span class="sd">    &gt;&gt;&gt; schema({})</span>
<span class="sd">    {}</span>
<span class="sd">    &gt;&gt;&gt; schema = Schema({Optional(&#39;key&#39;, default=&#39;value&#39;): str})</span>
<span class="sd">    &gt;&gt;&gt; schema({})</span>
<span class="sd">    {&#39;key&#39;: &#39;value&#39;}</span>
<span class="sd">    &gt;&gt;&gt; schema = Schema({Optional(&#39;key&#39;, default=list): list})</span>
<span class="sd">    &gt;&gt;&gt; schema({})</span>
<span class="sd">    {&#39;key&#39;: []}</span>

<span class="sd">    If &#39;required&#39; flag is set for an entire schema, optional keys aren&#39;t required</span>

<span class="sd">    &gt;&gt;&gt; schema = Schema({</span>
<span class="sd">    ...    Optional(&#39;key&#39;): str,</span>
<span class="sd">    ...    &#39;key2&#39;: str</span>
<span class="sd">    ... }, required=True)</span>
<span class="sd">    &gt;&gt;&gt; schema({&#39;key2&#39;:&#39;value&#39;})</span>
<span class="sd">    {&#39;key2&#39;: &#39;value&#39;}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">UNDEFINED</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Optional</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default_factory</span><span class="p">(</span><span class="n">default</span><span class="p">)</span></div>


<div class="viewcode-block" id="Exclusive"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Exclusive">[docs]</a><span class="k">class</span> <span class="nc">Exclusive</span><span class="p">(</span><span class="n">Optional</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mark a node in the schema as exclusive.</span>

<span class="sd">    Exclusive keys inherited from Optional:</span>

<span class="sd">    &gt;&gt;&gt; schema = Schema({Exclusive(&#39;alpha&#39;, &#39;angles&#39;): int, Exclusive(&#39;beta&#39;, &#39;angles&#39;): int})</span>
<span class="sd">    &gt;&gt;&gt; schema({&#39;alpha&#39;: 30})</span>
<span class="sd">    {&#39;alpha&#39;: 30}</span>

<span class="sd">    Keys inside a same group of exclusion cannot be together, it only makes sense for dictionaries:</span>

<span class="sd">    &gt;&gt;&gt; with raises(MultipleInvalid, &quot;two or more values in the same group of exclusion &#39;angles&#39; @ data[&lt;angles&gt;]&quot;):</span>
<span class="sd">    ...   schema({&#39;alpha&#39;: 30, &#39;beta&#39;: 45})</span>

<span class="sd">    For example, API can provides multiple types of authentication, but only one works in the same time:</span>

<span class="sd">    &gt;&gt;&gt; msg = &#39;Please, use only one type of authentication at the same time.&#39;</span>
<span class="sd">    &gt;&gt;&gt; schema = Schema({</span>
<span class="sd">    ... Exclusive(&#39;classic&#39;, &#39;auth&#39;, msg=msg):{</span>
<span class="sd">    ...     Required(&#39;email&#39;): basestring,</span>
<span class="sd">    ...     Required(&#39;password&#39;): basestring</span>
<span class="sd">    ...     },</span>
<span class="sd">    ... Exclusive(&#39;internal&#39;, &#39;auth&#39;, msg=msg):{</span>
<span class="sd">    ...     Required(&#39;secret_key&#39;): basestring</span>
<span class="sd">    ...     },</span>
<span class="sd">    ... Exclusive(&#39;social&#39;, &#39;auth&#39;, msg=msg):{</span>
<span class="sd">    ...     Required(&#39;social_network&#39;): basestring,</span>
<span class="sd">    ...     Required(&#39;token&#39;): basestring</span>
<span class="sd">    ...     }</span>
<span class="sd">    ... })</span>

<span class="sd">    &gt;&gt;&gt; with raises(MultipleInvalid, &quot;Please, use only one type of authentication at the same time. @ data[&lt;auth&gt;]&quot;):</span>
<span class="sd">    ...     schema({&#39;classic&#39;: {&#39;email&#39;: &#39;foo@example.com&#39;, &#39;password&#39;: &#39;bar&#39;},</span>
<span class="sd">    ...             &#39;social&#39;: {&#39;social_network&#39;: &#39;barfoo&#39;, &#39;token&#39;: &#39;tEMp&#39;}})</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">group_of_exclusion</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Exclusive</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_of_exclusion</span> <span class="o">=</span> <span class="n">group_of_exclusion</span></div>


<div class="viewcode-block" id="Inclusive"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Inclusive">[docs]</a><span class="k">class</span> <span class="nc">Inclusive</span><span class="p">(</span><span class="n">Optional</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Mark a node in the schema as inclusive.</span>

<span class="sd">    Exclusive keys inherited from Optional:</span>

<span class="sd">    &gt;&gt;&gt; schema = Schema({</span>
<span class="sd">    ...     Inclusive(&#39;filename&#39;, &#39;file&#39;): str,</span>
<span class="sd">    ...     Inclusive(&#39;mimetype&#39;, &#39;file&#39;): str</span>
<span class="sd">    ... })</span>
<span class="sd">    &gt;&gt;&gt; data = {&#39;filename&#39;: &#39;dog.jpg&#39;, &#39;mimetype&#39;: &#39;image/jpeg&#39;}</span>
<span class="sd">    &gt;&gt;&gt; data == schema(data)</span>
<span class="sd">    True</span>

<span class="sd">    Keys inside a same group of inclusive must exist together, it only makes sense for dictionaries:</span>

<span class="sd">    &gt;&gt;&gt; with raises(MultipleInvalid, &quot;some but not all values in the same group of inclusion &#39;file&#39; @ data[&lt;file&gt;]&quot;):</span>
<span class="sd">    ...     schema({&#39;filename&#39;: &#39;dog.jpg&#39;})</span>

<span class="sd">    If none of the keys in the group are present, it is accepted:</span>

<span class="sd">    &gt;&gt;&gt; schema({})</span>
<span class="sd">    {}</span>

<span class="sd">    For example, API can return &#39;height&#39; and &#39;width&#39; together, but not separately.</span>

<span class="sd">    &gt;&gt;&gt; msg = &quot;Height and width must exist together&quot;</span>
<span class="sd">    &gt;&gt;&gt; schema = Schema({</span>
<span class="sd">    ...     Inclusive(&#39;height&#39;, &#39;size&#39;, msg=msg): int,</span>
<span class="sd">    ...     Inclusive(&#39;width&#39;, &#39;size&#39;, msg=msg): int</span>
<span class="sd">    ... })</span>

<span class="sd">    &gt;&gt;&gt; with raises(MultipleInvalid, msg + &quot; @ data[&lt;size&gt;]&quot;):</span>
<span class="sd">    ...     schema({&#39;height&#39;: 100})</span>

<span class="sd">    &gt;&gt;&gt; with raises(MultipleInvalid, msg + &quot; @ data[&lt;size&gt;]&quot;):</span>
<span class="sd">    ...     schema({&#39;width&#39;: 100})</span>

<span class="sd">    &gt;&gt;&gt; data = {&#39;height&#39;: 100, &#39;width&#39;: 100}</span>
<span class="sd">    &gt;&gt;&gt; data == schema(data)</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">group_of_inclusion</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Inclusive</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_of_inclusion</span> <span class="o">=</span> <span class="n">group_of_inclusion</span></div>


<div class="viewcode-block" id="Required"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Required">[docs]</a><span class="k">class</span> <span class="nc">Required</span><span class="p">(</span><span class="n">Marker</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mark a node in the schema as being required, and optionally provide a default value.</span>

<span class="sd">    &gt;&gt;&gt; schema = Schema({Required(&#39;key&#39;): str})</span>
<span class="sd">    &gt;&gt;&gt; with raises(MultipleInvalid, &quot;required key not provided @ data[&#39;key&#39;]&quot;):</span>
<span class="sd">    ...   schema({})</span>

<span class="sd">    &gt;&gt;&gt; schema = Schema({Required(&#39;key&#39;, default=&#39;value&#39;): str})</span>
<span class="sd">    &gt;&gt;&gt; schema({})</span>
<span class="sd">    {&#39;key&#39;: &#39;value&#39;}</span>
<span class="sd">    &gt;&gt;&gt; schema = Schema({Required(&#39;key&#39;, default=list): list})</span>
<span class="sd">    &gt;&gt;&gt; schema({})</span>
<span class="sd">    {&#39;key&#39;: []}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">UNDEFINED</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Required</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default_factory</span><span class="p">(</span><span class="n">default</span><span class="p">)</span></div>


<div class="viewcode-block" id="Remove"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Remove">[docs]</a><span class="k">class</span> <span class="nc">Remove</span><span class="p">(</span><span class="n">Marker</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mark a node in the schema to be removed and excluded from the validated</span>
<span class="sd">    output. Keys that fail validation will not raise ``Invalid``. Instead, these</span>
<span class="sd">    keys will be treated as extras.</span>

<span class="sd">    &gt;&gt;&gt; schema = Schema({str: int, Remove(int): str})</span>
<span class="sd">    &gt;&gt;&gt; with raises(MultipleInvalid, &quot;extra keys not allowed @ data[1]&quot;):</span>
<span class="sd">    ...    schema({&#39;keep&#39;: 1, 1: 1.0})</span>
<span class="sd">    &gt;&gt;&gt; schema({1: &#39;red&#39;, &#39;red&#39;: 1, 2: &#39;green&#39;})</span>
<span class="sd">    {&#39;red&#39;: 1}</span>
<span class="sd">    &gt;&gt;&gt; schema = Schema([int, Remove(float), Extra])</span>
<span class="sd">    &gt;&gt;&gt; schema([1, 2, 3, 4.0, 5, 6.0, &#39;7&#39;])</span>
<span class="sd">    [1, 2, 3, 5, &#39;7&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Remove</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__call__</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;Remove(</span><span class="si">%r</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">,)</span></div>


<div class="viewcode-block" id="Extra"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Extra">[docs]</a><span class="k">def</span> <span class="nf">Extra</span><span class="p">(</span><span class="n">_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Allow keys in the data that are not present in the schema.&quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="n">SchemaError</span><span class="p">(</span><span class="s">&#39;&quot;Extra&quot; should never be called&#39;</span><span class="p">)</span></div>


<span class="c"># As extra() is never called there&#39;s no way to catch references to the</span>
<span class="c"># deprecated object, so we just leave an alias here instead.</span>
<span class="n">extra</span> <span class="o">=</span> <span class="n">Extra</span>

<div class="viewcode-block" id="Msg"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Msg">[docs]</a><span class="k">class</span> <span class="nc">Msg</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Report a user-friendly message if a schema fails to validate.</span>

<span class="sd">    &gt;&gt;&gt; validate = Schema(</span>
<span class="sd">    ...   Msg([&#39;one&#39;, &#39;two&#39;, int],</span>
<span class="sd">    ...       &#39;should be one of &quot;one&quot;, &quot;two&quot; or an integer&#39;))</span>
<span class="sd">    &gt;&gt;&gt; with raises(MultipleInvalid, &#39;should be one of &quot;one&quot;, &quot;two&quot; or an integer&#39;):</span>
<span class="sd">    ...   validate([&#39;three&#39;])</span>

<span class="sd">    Messages are only applied to invalid direct descendants of the schema:</span>

<span class="sd">    &gt;&gt;&gt; validate = Schema(Msg([[&#39;one&#39;, &#39;two&#39;, int]], &#39;not okay!&#39;))</span>
<span class="sd">    &gt;&gt;&gt; with raises(MultipleInvalid, &#39;invalid list value @ data[0][0]&#39;):</span>
<span class="sd">    ...   validate([[&#39;three&#39;]])</span>

<span class="sd">    The type which is thrown can be overridden but needs to be a subclass of Invalid</span>

<span class="sd">    &gt;&gt;&gt; with raises(SchemaError, &#39;Msg can only use subclases of Invalid as custom class&#39;):</span>
<span class="sd">    ...   validate = Schema(Msg([int], &#39;should be int&#39;, cls=KeyError))</span>

<span class="sd">    If you do use a subclass of Invalid, that error will be thrown (wrapped in a MultipleInvalid)</span>

<span class="sd">    &gt;&gt;&gt; validate = Schema(Msg([[&#39;one&#39;, &#39;two&#39;, int]], &#39;not okay!&#39;, cls=RangeInvalid))</span>
<span class="sd">    &gt;&gt;&gt; try:</span>
<span class="sd">    ...  validate([&#39;three&#39;])</span>
<span class="sd">    ... except MultipleInvalid as e:</span>
<span class="sd">    ...   assert isinstance(e.errors[0], RangeInvalid)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">cls</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cls</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">Invalid</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">SchemaError</span><span class="p">(</span><span class="s">&quot;Msg can only use subclases of&quot;</span>
                              <span class="s">&quot; Invalid as custom class&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span> <span class="o">=</span> <span class="n">schema</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cls</span> <span class="o">=</span> <span class="n">cls</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Invalid</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span> <span class="ow">or</span> <span class="n">Invalid</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Msg(</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, cls=</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_schema</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">)</span></div>


<div class="viewcode-block" id="message"><a class="viewcode-back" href="../voluptuous.html#voluptuous.message">[docs]</a><span class="k">def</span> <span class="nf">message</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cls</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convenience decorator to allow functions to provide a message.</span>

<span class="sd">    Set a default message:</span>

<span class="sd">        &gt;&gt;&gt; @message(&#39;not an integer&#39;)</span>
<span class="sd">        ... def isint(v):</span>
<span class="sd">        ...   return int(v)</span>

<span class="sd">        &gt;&gt;&gt; validate = Schema(isint())</span>
<span class="sd">        &gt;&gt;&gt; with raises(MultipleInvalid, &#39;not an integer&#39;):</span>
<span class="sd">        ...   validate(&#39;a&#39;)</span>

<span class="sd">    The message can be overridden on a per validator basis:</span>

<span class="sd">        &gt;&gt;&gt; validate = Schema(isint(&#39;bad&#39;))</span>
<span class="sd">        &gt;&gt;&gt; with raises(MultipleInvalid, &#39;bad&#39;):</span>
<span class="sd">        ...   validate(&#39;a&#39;)</span>

<span class="sd">    The class thrown too:</span>

<span class="sd">        &gt;&gt;&gt; class IntegerInvalid(Invalid): pass</span>
<span class="sd">        &gt;&gt;&gt; validate = Schema(isint(&#39;bad&#39;, clsoverride=IntegerInvalid))</span>
<span class="sd">        &gt;&gt;&gt; try:</span>
<span class="sd">        ...  validate(&#39;a&#39;)</span>
<span class="sd">        ... except MultipleInvalid as e:</span>
<span class="sd">        ...   assert isinstance(e.errors[0], IntegerInvalid)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cls</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">Invalid</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SchemaError</span><span class="p">(</span><span class="s">&quot;message can only use subclases of Invalid as custom class&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">clsoverride</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
            <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="p">(</span><span class="n">clsoverride</span> <span class="ow">or</span> <span class="n">cls</span> <span class="ow">or</span> <span class="n">ValueInvalid</span><span class="p">)(</span><span class="n">msg</span> <span class="ow">or</span> <span class="n">default</span> <span class="ow">or</span> <span class="s">&#39;invalid value&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">wrapper</span>
        <span class="k">return</span> <span class="n">check</span>
    <span class="k">return</span> <span class="n">decorator</span></div>


<div class="viewcode-block" id="truth"><a class="viewcode-back" href="../voluptuous.html#voluptuous.truth">[docs]</a><span class="k">def</span> <span class="nf">truth</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convenience decorator to convert truth functions into validators.</span>

<span class="sd">        &gt;&gt;&gt; @truth</span>
<span class="sd">        ... def isdir(v):</span>
<span class="sd">        ...   return os.path.isdir(v)</span>
<span class="sd">        &gt;&gt;&gt; validate = Schema(isdir)</span>
<span class="sd">        &gt;&gt;&gt; validate(&#39;/&#39;)</span>
<span class="sd">        &#39;/&#39;</span>
<span class="sd">        &gt;&gt;&gt; with raises(MultipleInvalid, &#39;not a valid value&#39;):</span>
<span class="sd">        ...   validate(&#39;/notavaliddir&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">return</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">check</span></div>


<div class="viewcode-block" id="Coerce"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Coerce">[docs]</a><span class="k">class</span> <span class="nc">Coerce</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Coerce a value to a type.</span>

<span class="sd">    If the type constructor throws a ValueError or TypeError, the value</span>
<span class="sd">    will be marked as Invalid.</span>

<span class="sd">    Default behavior:</span>

<span class="sd">        &gt;&gt;&gt; validate = Schema(Coerce(int))</span>
<span class="sd">        &gt;&gt;&gt; with raises(MultipleInvalid, &#39;expected int&#39;):</span>
<span class="sd">        ...   validate(None)</span>
<span class="sd">        &gt;&gt;&gt; with raises(MultipleInvalid, &#39;expected int&#39;):</span>
<span class="sd">        ...   validate(&#39;foo&#39;)</span>

<span class="sd">    With custom message:</span>

<span class="sd">        &gt;&gt;&gt; validate = Schema(Coerce(int, &quot;moo&quot;))</span>
<span class="sd">        &gt;&gt;&gt; with raises(MultipleInvalid, &#39;moo&#39;):</span>
<span class="sd">        ...   validate(&#39;foo&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type_name</span> <span class="o">=</span> <span class="nb">type</span><span class="o">.</span><span class="n">__name__</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="ow">or</span> <span class="p">(</span><span class="s">&#39;expected </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_name</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">CoerceInvalid</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Coerce(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type_name</span><span class="p">)</span></div>


<span class="nd">@message</span><span class="p">(</span><span class="s">&#39;value was not true&#39;</span><span class="p">,</span> <span class="n">cls</span><span class="o">=</span><span class="n">TrueInvalid</span><span class="p">)</span>
<span class="nd">@truth</span>
<div class="viewcode-block" id="IsTrue"><a class="viewcode-back" href="../voluptuous.html#voluptuous.IsTrue">[docs]</a><span class="k">def</span> <span class="nf">IsTrue</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Assert that a value is true, in the Python sense.</span>

<span class="sd">    &gt;&gt;&gt; validate = Schema(IsTrue())</span>

<span class="sd">    &quot;In the Python sense&quot; means that implicitly false values, such as empty</span>
<span class="sd">    lists, dictionaries, etc. are treated as &quot;false&quot;:</span>

<span class="sd">    &gt;&gt;&gt; with raises(MultipleInvalid, &quot;value was not true&quot;):</span>
<span class="sd">    ...   validate([])</span>
<span class="sd">    &gt;&gt;&gt; validate([1])</span>
<span class="sd">    [1]</span>
<span class="sd">    &gt;&gt;&gt; with raises(MultipleInvalid, &quot;value was not true&quot;):</span>
<span class="sd">    ...   validate(False)</span>

<span class="sd">    ...and so on.</span>

<span class="sd">    &gt;&gt;&gt; try:</span>
<span class="sd">    ...  validate([])</span>
<span class="sd">    ... except MultipleInvalid as e:</span>
<span class="sd">    ...   assert isinstance(e.errors[0], TrueInvalid)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">v</span></div>


<span class="nd">@message</span><span class="p">(</span><span class="s">&#39;value was not false&#39;</span><span class="p">,</span> <span class="n">cls</span><span class="o">=</span><span class="n">FalseInvalid</span><span class="p">)</span>
<div class="viewcode-block" id="IsFalse"><a class="viewcode-back" href="../voluptuous.html#voluptuous.IsFalse">[docs]</a><span class="k">def</span> <span class="nf">IsFalse</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Assert that a value is false, in the Python sense.</span>

<span class="sd">    (see :func:`IsTrue` for more detail)</span>

<span class="sd">    &gt;&gt;&gt; validate = Schema(IsFalse())</span>
<span class="sd">    &gt;&gt;&gt; validate([])</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; with raises(MultipleInvalid, &quot;value was not false&quot;):</span>
<span class="sd">    ...   validate(True)</span>

<span class="sd">    &gt;&gt;&gt; try:</span>
<span class="sd">    ...  validate(True)</span>
<span class="sd">    ... except MultipleInvalid as e:</span>
<span class="sd">    ...   assert isinstance(e.errors[0], FalseInvalid)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span>
    <span class="k">return</span> <span class="n">v</span></div>


<span class="nd">@message</span><span class="p">(</span><span class="s">&#39;expected boolean&#39;</span><span class="p">,</span> <span class="n">cls</span><span class="o">=</span><span class="n">BooleanInvalid</span><span class="p">)</span>
<div class="viewcode-block" id="Boolean"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Boolean">[docs]</a><span class="k">def</span> <span class="nf">Boolean</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert human-readable boolean values to a bool.</span>

<span class="sd">    Accepted values are 1, true, yes, on, enable, and their negatives.</span>
<span class="sd">    Non-string values are cast to bool.</span>

<span class="sd">    &gt;&gt;&gt; validate = Schema(Boolean())</span>
<span class="sd">    &gt;&gt;&gt; validate(True)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; validate(&quot;1&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; validate(&quot;0&quot;)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; with raises(MultipleInvalid, &quot;expected boolean&quot;):</span>
<span class="sd">    ...   validate(&#39;moo&#39;)</span>
<span class="sd">    &gt;&gt;&gt; try:</span>
<span class="sd">    ...  validate(&#39;moo&#39;)</span>
<span class="sd">    ... except MultipleInvalid as e:</span>
<span class="sd">    ...   assert isinstance(e.errors[0], BooleanInvalid)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="s">&#39;true&#39;</span><span class="p">,</span> <span class="s">&#39;yes&#39;</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">,</span> <span class="s">&#39;enable&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="s">&#39;false&#39;</span><span class="p">,</span> <span class="s">&#39;no&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">,</span> <span class="s">&#39;disable&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">raise</span> <span class="ne">ValueError</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></div>


<div class="viewcode-block" id="Any"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Any">[docs]</a><span class="k">class</span> <span class="nc">Any</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Use the first validated value.</span>

<span class="sd">    :param msg: Message to deliver to user if validation fails.</span>
<span class="sd">    :param kwargs: All other keyword arguments are passed to the sub-Schema constructors.</span>
<span class="sd">    :returns: Return value of the first validator that passes.</span>

<span class="sd">    &gt;&gt;&gt; validate = Schema(Any(&#39;true&#39;, &#39;false&#39;,</span>
<span class="sd">    ...                       All(Any(int, bool), Coerce(bool))))</span>
<span class="sd">    &gt;&gt;&gt; validate(&#39;true&#39;)</span>
<span class="sd">    &#39;true&#39;</span>
<span class="sd">    &gt;&gt;&gt; validate(1)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; with raises(MultipleInvalid, &quot;not a valid value&quot;):</span>
<span class="sd">    ...   validate(&#39;moo&#39;)</span>

<span class="sd">    msg argument is used</span>

<span class="sd">    &gt;&gt;&gt; validate = Schema(Any(1, 2, 3, msg=&quot;Expected 1 2 or 3&quot;))</span>
<span class="sd">    &gt;&gt;&gt; validate(1)</span>
<span class="sd">    1</span>
<span class="sd">    &gt;&gt;&gt; with raises(MultipleInvalid, &quot;Expected 1 2 or 3&quot;):</span>
<span class="sd">    ...   validate(4)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">validators</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validators</span> <span class="o">=</span> <span class="n">validators</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;msg&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span> <span class="o">=</span> <span class="p">[</span><span class="n">Schema</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">validators</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="n">error</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">schema</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">schema</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">Invalid</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">error</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">error</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">AnyInvalid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">AnyInvalid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="ow">or</span> <span class="s">&#39;no valid value found&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Any([</span><span class="si">%s</span><span class="s">])&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validators</span><span class="p">))</span></div>


<span class="c"># Convenience alias</span>
<span class="n">Or</span> <span class="o">=</span> <span class="n">Any</span>


<div class="viewcode-block" id="All"><a class="viewcode-back" href="../voluptuous.html#voluptuous.All">[docs]</a><span class="k">class</span> <span class="nc">All</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Value must pass all validators.</span>

<span class="sd">    The output of each validator is passed as input to the next.</span>

<span class="sd">    :param msg: Message to deliver to user if validation fails.</span>
<span class="sd">    :param kwargs: All other keyword arguments are passed to the sub-Schema constructors.</span>

<span class="sd">    &gt;&gt;&gt; validate = Schema(All(&#39;10&#39;, Coerce(int)))</span>
<span class="sd">    &gt;&gt;&gt; validate(&#39;10&#39;)</span>
<span class="sd">    10</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">validators</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validators</span> <span class="o">=</span> <span class="n">validators</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;msg&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span> <span class="o">=</span> <span class="p">[</span><span class="n">Schema</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">validators</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">schema</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">schema</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Invalid</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">AllInvalid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;All([</span><span class="si">%s</span><span class="s">])&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validators</span><span class="p">))</span></div>


<span class="c"># Convenience alias</span>
<span class="n">And</span> <span class="o">=</span> <span class="n">All</span>


<div class="viewcode-block" id="Match"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Match">[docs]</a><span class="k">class</span> <span class="nc">Match</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Value must be a string that matches the regular expression.</span>

<span class="sd">    &gt;&gt;&gt; validate = Schema(Match(r&#39;^0x[A-F0-9]+$&#39;))</span>
<span class="sd">    &gt;&gt;&gt; validate(&#39;0x123EF4&#39;)</span>
<span class="sd">    &#39;0x123EF4&#39;</span>
<span class="sd">    &gt;&gt;&gt; with raises(MultipleInvalid, &quot;does not match regular expression&quot;):</span>
<span class="sd">    ...   validate(&#39;123EF4&#39;)</span>

<span class="sd">    &gt;&gt;&gt; with raises(MultipleInvalid, &#39;expected string or buffer&#39;):</span>
<span class="sd">    ...   validate(123)</span>

<span class="sd">    Pattern may also be a _compiled regular expression:</span>

<span class="sd">    &gt;&gt;&gt; validate = Schema(Match(re.compile(r&#39;0x[A-F0-9]+&#39;, re.I)))</span>
<span class="sd">    &gt;&gt;&gt; validate(&#39;0x123ef4&#39;)</span>
<span class="sd">    &#39;0x123ef4&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MatchInvalid</span><span class="p">(</span><span class="s">&quot;expected string or buffer&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MatchInvalid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="ow">or</span> <span class="s">&#39;does not match regular expression&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Match(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">pattern</span><span class="p">)</span></div>


<div class="viewcode-block" id="Replace"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Replace">[docs]</a><span class="k">class</span> <span class="nc">Replace</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Regex substitution.</span>

<span class="sd">    &gt;&gt;&gt; validate = Schema(All(Replace(&#39;you&#39;, &#39;I&#39;),</span>
<span class="sd">    ...                       Replace(&#39;hello&#39;, &#39;goodbye&#39;)))</span>
<span class="sd">    &gt;&gt;&gt; validate(&#39;you say hello&#39;)</span>
<span class="sd">    &#39;I say goodbye&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">substitution</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">substitution</span> <span class="o">=</span> <span class="n">substitution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">substitution</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Replace(</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">substitution</span><span class="p">)</span></div>


<span class="nd">@message</span><span class="p">(</span><span class="s">&#39;expected a URL&#39;</span><span class="p">,</span> <span class="n">cls</span><span class="o">=</span><span class="n">UrlInvalid</span><span class="p">)</span>
<div class="viewcode-block" id="Url"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Url">[docs]</a><span class="k">def</span> <span class="nf">Url</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Verify that the value is a URL.</span>

<span class="sd">    &gt;&gt;&gt; s = Schema(Url())</span>
<span class="sd">    &gt;&gt;&gt; with raises(MultipleInvalid, &#39;expected a URL&#39;):</span>
<span class="sd">    ...   s(1)</span>
<span class="sd">    &gt;&gt;&gt; s(&#39;http://w3.org&#39;)</span>
<span class="sd">    &#39;http://w3.org&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parsed</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">parsed</span><span class="o">.</span><span class="n">netloc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UrlInvalid</span><span class="p">(</span><span class="s">&quot;must have a URL scheme and host&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span></div>


<span class="nd">@message</span><span class="p">(</span><span class="s">&#39;not a file&#39;</span><span class="p">,</span> <span class="n">cls</span><span class="o">=</span><span class="n">FileInvalid</span><span class="p">)</span>
<span class="nd">@truth</span>
<div class="viewcode-block" id="IsFile"><a class="viewcode-back" href="../voluptuous.html#voluptuous.IsFile">[docs]</a><span class="k">def</span> <span class="nf">IsFile</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Verify the file exists.</span>

<span class="sd">    &gt;&gt;&gt; os.path.basename(IsFile()(__file__)).startswith(&#39;voluptuous.py&#39;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; with raises(FileInvalid, &#39;not a file&#39;):</span>
<span class="sd">    ...   IsFile()(&quot;random_filename_goes_here.py&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></div>


<span class="nd">@message</span><span class="p">(</span><span class="s">&#39;not a directory&#39;</span><span class="p">,</span> <span class="n">cls</span><span class="o">=</span><span class="n">DirInvalid</span><span class="p">)</span>
<span class="nd">@truth</span>
<div class="viewcode-block" id="IsDir"><a class="viewcode-back" href="../voluptuous.html#voluptuous.IsDir">[docs]</a><span class="k">def</span> <span class="nf">IsDir</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Verify the directory exists.</span>

<span class="sd">    &gt;&gt;&gt; IsDir()(&#39;/&#39;)</span>
<span class="sd">    &#39;/&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></div>


<span class="nd">@message</span><span class="p">(</span><span class="s">&#39;path does not exist&#39;</span><span class="p">,</span> <span class="n">cls</span><span class="o">=</span><span class="n">PathInvalid</span><span class="p">)</span>
<span class="nd">@truth</span>
<div class="viewcode-block" id="PathExists"><a class="viewcode-back" href="../voluptuous.html#voluptuous.PathExists">[docs]</a><span class="k">def</span> <span class="nf">PathExists</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Verify the path exists, regardless of its type.</span>

<span class="sd">    &gt;&gt;&gt; os.path.basename(PathExists()(__file__)).startswith(&#39;voluptuous.py&#39;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; with raises(Invalid, &#39;path does not exist&#39;):</span>
<span class="sd">    ...   PathExists()(&quot;random_filename_goes_here.py&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></div>


<div class="viewcode-block" id="Range"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Range">[docs]</a><span class="k">class</span> <span class="nc">Range</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Limit a value to a range.</span>

<span class="sd">    Either min or max may be omitted.</span>
<span class="sd">    Either min or max can be excluded from the range of accepted values.</span>

<span class="sd">    :raises Invalid: If the value is outside the range.</span>

<span class="sd">    &gt;&gt;&gt; s = Schema(Range(min=1, max=10, min_included=False))</span>
<span class="sd">    &gt;&gt;&gt; s(5)</span>
<span class="sd">    5</span>
<span class="sd">    &gt;&gt;&gt; s(10)</span>
<span class="sd">    10</span>
<span class="sd">    &gt;&gt;&gt; with raises(MultipleInvalid, &#39;value must be at most 10&#39;):</span>
<span class="sd">    ...   s(20)</span>
<span class="sd">    &gt;&gt;&gt; with raises(MultipleInvalid, &#39;value must be higher than 1&#39;):</span>
<span class="sd">    ...   s(1)</span>
<span class="sd">    &gt;&gt;&gt; with raises(MultipleInvalid, &#39;value must be lower than 10&#39;):</span>
<span class="sd">    ...   Schema(Range(max=10, max_included=False))(20)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">min_included</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">max_included</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="nb">min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="nb">max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_included</span> <span class="o">=</span> <span class="n">min_included</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_included</span> <span class="o">=</span> <span class="n">max_included</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_included</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RangeInvalid</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="ow">or</span> <span class="s">&#39;value must be at least </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RangeInvalid</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="ow">or</span> <span class="s">&#39;value must be higher than </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_included</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RangeInvalid</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="ow">or</span> <span class="s">&#39;value must be at most </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RangeInvalid</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="ow">or</span> <span class="s">&#39;value must be lower than </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">&#39;Range(min=</span><span class="si">%s</span><span class="s">, max=</span><span class="si">%s</span><span class="s">, min_included=</span><span class="si">%s</span><span class="s">,&#39;</span>
                <span class="s">&#39; max_included=</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">min_included</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">max_included</span><span class="p">))</span></div>


<div class="viewcode-block" id="Clamp"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Clamp">[docs]</a><span class="k">class</span> <span class="nc">Clamp</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Clamp a value to a range.</span>

<span class="sd">    Either min or max may be omitted.</span>
<span class="sd">    &gt;&gt;&gt; s = Schema(Clamp(min=0, max=1))</span>
<span class="sd">    &gt;&gt;&gt; s(0.5)</span>
<span class="sd">    0.5</span>
<span class="sd">    &gt;&gt;&gt; s(5)</span>
<span class="sd">    1</span>
<span class="sd">    &gt;&gt;&gt; s(-1)</span>
<span class="sd">    0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="nb">min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="nb">max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Clamp(min=</span><span class="si">%s</span><span class="s">, max=</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">)</span></div>


<div class="viewcode-block" id="LengthInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.LengthInvalid">[docs]</a><span class="k">class</span> <span class="nc">LengthInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="Length"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Length">[docs]</a><span class="k">class</span> <span class="nc">Length</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The length of a value must be in a certain range.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="nb">min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="nb">max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LengthInvalid</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="ow">or</span> <span class="s">&#39;length of value must be at least </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LengthInvalid</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="ow">or</span> <span class="s">&#39;length of value must be at most </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Length(min=</span><span class="si">%s</span><span class="s">, max=</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">)</span></div>


<div class="viewcode-block" id="DatetimeInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.DatetimeInvalid">[docs]</a><span class="k">class</span> <span class="nc">DatetimeInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The value is not a formatted datetime string.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Datetime"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Datetime">[docs]</a><span class="k">class</span> <span class="nc">Datetime</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate that the value matches the datetime format.&quot;&quot;&quot;</span>

    <span class="n">DEFAULT_FORMAT</span> <span class="o">=</span> <span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">T%H:%M:%S.</span><span class="si">%f</span><span class="s">Z&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">format</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_FORMAT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DatetimeInvalid</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="ow">or</span> <span class="s">&#39;value does not match&#39;</span>
                            <span class="s">&#39; expected format </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Datetime(format=</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span></div>


<div class="viewcode-block" id="InInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.InInvalid">[docs]</a><span class="k">class</span> <span class="nc">InInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="In"><a class="viewcode-back" href="../voluptuous.html#voluptuous.In">[docs]</a><span class="k">class</span> <span class="nc">In</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate that a value is in a collection.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="n">container</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">check</span> <span class="o">=</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">check</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InInvalid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="ow">or</span> <span class="s">&#39;value is not allowed&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;In(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="p">,)</span></div>


<div class="viewcode-block" id="NotInInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.NotInInvalid">[docs]</a><span class="k">class</span> <span class="nc">NotInInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="NotIn"><a class="viewcode-back" href="../voluptuous.html#voluptuous.NotIn">[docs]</a><span class="k">class</span> <span class="nc">NotIn</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate that a value is not in a collection.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="n">container</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">check</span> <span class="o">=</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">check</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotInInvalid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="ow">or</span> <span class="s">&#39;value is not allowed&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;NotIn(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="p">,)</span></div>


<div class="viewcode-block" id="Lower"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Lower">[docs]</a><span class="k">def</span> <span class="nf">Lower</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transform a string to lower case.</span>

<span class="sd">    &gt;&gt;&gt; s = Schema(Lower)</span>
<span class="sd">    &gt;&gt;&gt; s(&#39;HI&#39;)</span>
<span class="sd">    &#39;hi&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span></div>


<div class="viewcode-block" id="Upper"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Upper">[docs]</a><span class="k">def</span> <span class="nf">Upper</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transform a string to upper case.</span>

<span class="sd">    &gt;&gt;&gt; s = Schema(Upper)</span>
<span class="sd">    &gt;&gt;&gt; s(&#39;hi&#39;)</span>
<span class="sd">    &#39;HI&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span></div>


<div class="viewcode-block" id="Capitalize"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Capitalize">[docs]</a><span class="k">def</span> <span class="nf">Capitalize</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Capitalise a string.</span>

<span class="sd">    &gt;&gt;&gt; s = Schema(Capitalize)</span>
<span class="sd">    &gt;&gt;&gt; s(&#39;hello world&#39;)</span>
<span class="sd">    &#39;Hello world&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span></div>


<div class="viewcode-block" id="Title"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Title">[docs]</a><span class="k">def</span> <span class="nf">Title</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Title case a string.</span>

<span class="sd">    &gt;&gt;&gt; s = Schema(Title)</span>
<span class="sd">    &gt;&gt;&gt; s(&#39;hello world&#39;)</span>
<span class="sd">    &#39;Hello World&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span></div>


<div class="viewcode-block" id="Strip"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Strip">[docs]</a><span class="k">def</span> <span class="nf">Strip</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Strip whitespace from a string.</span>

<span class="sd">    &gt;&gt;&gt; s = Schema(Strip)</span>
<span class="sd">    &gt;&gt;&gt; s(&#39;  hello world  &#39;)</span>
<span class="sd">    &#39;hello world&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div>


<div class="viewcode-block" id="DefaultTo"><a class="viewcode-back" href="../voluptuous.html#voluptuous.DefaultTo">[docs]</a><span class="k">class</span> <span class="nc">DefaultTo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets a value to default_value if none provided.</span>

<span class="sd">    &gt;&gt;&gt; s = Schema(DefaultTo(42))</span>
<span class="sd">    &gt;&gt;&gt; s(None)</span>
<span class="sd">    42</span>
<span class="sd">    &gt;&gt;&gt; s = Schema(DefaultTo(list))</span>
<span class="sd">    &gt;&gt;&gt; s(None)</span>
<span class="sd">    []</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">default_factory</span><span class="p">(</span><span class="n">default_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_value</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;DefaultTo(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_value</span><span class="p">(),)</span></div>


<div class="viewcode-block" id="SetTo"><a class="viewcode-back" href="../voluptuous.html#voluptuous.SetTo">[docs]</a><span class="k">class</span> <span class="nc">SetTo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set a value, ignoring any previous value.</span>

<span class="sd">    &gt;&gt;&gt; s = Schema(Any(int, SetTo(42)))</span>
<span class="sd">    &gt;&gt;&gt; s(2)</span>
<span class="sd">    2</span>
<span class="sd">    &gt;&gt;&gt; s(&quot;foo&quot;)</span>
<span class="sd">    42</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">default_factory</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;SetTo(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(),)</span></div>


<div class="viewcode-block" id="ExactSequenceInvalid"><a class="viewcode-back" href="../voluptuous.html#voluptuous.ExactSequenceInvalid">[docs]</a><span class="k">class</span> <span class="nc">ExactSequenceInvalid</span><span class="p">(</span><span class="n">Invalid</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="ExactSequence"><a class="viewcode-back" href="../voluptuous.html#voluptuous.ExactSequence">[docs]</a><span class="k">class</span> <span class="nc">ExactSequence</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Matches each element in a sequence against the corresponding element in</span>
<span class="sd">    the validators.</span>

<span class="sd">    :param msg: Message to deliver to user if validation fails.</span>
<span class="sd">    :param kwargs: All other keyword arguments are passed to the sub-Schema</span>
<span class="sd">        constructors.</span>

<span class="sd">    &gt;&gt;&gt; from voluptuous import *</span>
<span class="sd">    &gt;&gt;&gt; validate = Schema(ExactSequence([str, int, list, list]))</span>
<span class="sd">    &gt;&gt;&gt; validate([&#39;hourly_report&#39;, 10, [], []])</span>
<span class="sd">    [&#39;hourly_report&#39;, 10, [], []]</span>
<span class="sd">    &gt;&gt;&gt; validate((&#39;hourly_report&#39;, 10, [], []))</span>
<span class="sd">    (&#39;hourly_report&#39;, 10, [], [])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validators</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validators</span> <span class="o">=</span> <span class="n">validators</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;msg&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span> <span class="o">=</span> <span class="p">[</span><span class="n">Schema</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">validators</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">ExactSequenceInvalid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)(</span><span class="n">schema</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">schema</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">Invalid</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">ExactSequenceInvalid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;ExactSequence([</span><span class="si">%s</span><span class="s">])&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                                                  <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validators</span><span class="p">))</span></div>


<div class="viewcode-block" id="Literal"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Literal">[docs]</a><span class="k">class</span> <span class="nc">Literal</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lit</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lit</span> <span class="o">=</span> <span class="n">lit</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lit</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LiteralInvalid</span><span class="p">(</span>
                <span class="n">msg</span> <span class="ow">or</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> not match for </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lit</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lit</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lit</span><span class="p">)</span></div>


<div class="viewcode-block" id="Unique"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Unique">[docs]</a><span class="k">class</span> <span class="nc">Unique</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ensure an iterable does not contain duplicate items.</span>

<span class="sd">    Only iterables convertable to a set are supported (native types and</span>
<span class="sd">    objects with correct __eq__).</span>

<span class="sd">    JSON does not support set, so they need to be presented as arrays.</span>
<span class="sd">    Unique allows ensuring that such array does not contain dupes.</span>

<span class="sd">    &gt;&gt;&gt; s = Schema(Unique())</span>
<span class="sd">    &gt;&gt;&gt; s([])</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; s([1, 2])</span>
<span class="sd">    [1, 2]</span>
<span class="sd">    &gt;&gt;&gt; with raises(Invalid, &#39;contains duplicate items: [1]&#39;):</span>
<span class="sd">    ...   s([1, 1, 2])</span>
<span class="sd">    &gt;&gt;&gt; with raises(Invalid, &quot;contains duplicate items: [&#39;one&#39;]&quot;):</span>
<span class="sd">    ...   s([&#39;one&#39;, &#39;two&#39;, &#39;one&#39;])</span>
<span class="sd">    &gt;&gt;&gt; with raises(Invalid, regex=&quot;^contains unhashable elements: &quot;):</span>
<span class="sd">    ...   s([set([1, 2]), set([3, 4])])</span>
<span class="sd">    &gt;&gt;&gt; s(&#39;abc&#39;)</span>
<span class="sd">    &#39;abc&#39;</span>
<span class="sd">    &gt;&gt;&gt; with raises(Invalid, regex=&quot;^contains duplicate items: &quot;):</span>
<span class="sd">    ...   s(&#39;aabbc&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">set_v</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TypeInvalid</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="ow">or</span> <span class="s">&#39;contains unhashable elements: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">set_v</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">dupes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">seen</span> <span class="ow">or</span> <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="ow">or</span> <span class="s">&#39;contains duplicate items: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dupes</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Unique()&#39;</span></div>


<div class="viewcode-block" id="Set"><a class="viewcode-back" href="../voluptuous.html#voluptuous.Set">[docs]</a><span class="k">class</span> <span class="nc">Set</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a list into a set.</span>

<span class="sd">    &gt;&gt;&gt; s = Schema(Set())</span>
<span class="sd">    &gt;&gt;&gt; s([]) == set([])</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; s([1, 2]) == set([1, 2])</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; with raises(Invalid, regex=&quot;^cannot be presented as set: &quot;):</span>
<span class="sd">    ...   s([set([1, 2]), set([3, 4])])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">set_v</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TypeInvalid</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="ow">or</span> <span class="s">&#39;cannot be presented as set: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">set_v</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Set()&#39;</span></div>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Alec Thomas.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
    </div>

    

    
  </body>
</html>